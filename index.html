<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ƒê√†n Piano - Tone Dm</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh;
            padding: 5px; touch-action: manipulation; overflow-x: hidden; }
        .sound-toggle { background: linear-gradient(145deg, #4CAF50, #45a049); color: white; border: none; border-radius: 50%;
            width: 50px; height: 50px; font-size: 24px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.2s; display: flex; align-items: center; justify-content: center; touch-action: manipulation; }
        .sound-toggle:active { transform: scale(0.95); }
        .sound-toggle.muted { background: linear-gradient(145deg, #f44336, #d32f2f); }
        .container { width: 100%; max-width: 100vw; }
        .title { text-align: center; color: #FFD700; margin-bottom: 8px; font-size: 18px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-weight: bold; }
        .created-by { text-align: center; color: #fff; font-size: 13px; margin-top: 0px; margin-bottom: 8px; opacity: 0.85; font-weight: 400; }
        .chords-section { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 10px; padding: 6px; margin-bottom: 4px; max-width: 280px; margin-left: 8px; margin-right: auto; }
        .instrument-selector { position: relative; margin-bottom: 8px; }
        .instrument-current { background: linear-gradient(145deg, #9C27B0, #7B1FA2); color: white; border: none; border-radius: 6px; padding: 8px 12px;
            font-size: 13px; font-weight: bold; cursor: pointer; width: 100%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .instrument-current:active { transform: scale(0.98); }
        .instrument-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            border-radius: 6px; margin-top: 4px; max-height: 0; overflow: hidden; transition: max-height 0.3s ease; z-index: 100; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
        .instrument-dropdown.open { max-height: 300px; overflow-y: auto; }
        .instrument-option { background: transparent; color: white; border: none; padding: 10px 12px; font-size: 13px; font-weight: bold; cursor: pointer; width: 100%; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); transition: background 0.2s; }
        .instrument-option:hover, .instrument-option:active { background: rgba(156, 39, 176, 0.3); }
        .instrument-option:last-child { border-bottom: none; }
        .tone-selector { display: flex; gap: 5px; margin-bottom: 8px; overflow-x: auto; justify-content: flex-start; padding: 0 4px; }
        .tone-btn { background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 6px; padding: 5px 8px; font-size: 11px; font-weight: bold; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
        .tone-btn.active { background: linear-gradient(145deg, #FF9800, #F57C00); border-color: #FF9800; }
        .tone-btn:active { transform: scale(0.95); }
        .chords-title { color: white; font-size: 12px; margin-bottom: 4px; text-align: center; }
        .chords-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-bottom: 4px; }
        .chord-btn { background: linear-gradient(145deg, #4CAF50, #45a049); color: white; border: 2px solid rgba(255,255,255,0.4); border-radius: 5px; padding: 6px 2px; font-size: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.3); transition: all 0.1s; touch-action: manipulation; }
        .chord-btn:active { transform: scale(0.95); box-shadow: 0 2px 3px rgba(0,0,0,0.3); background: linear-gradient(145deg, #66BB6A, #5CB860); }
        .piano-container { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); border-radius: 10px; padding: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); overflow-x: auto; overflow-y: hidden; width: 100%; max-width: 800px; }
        .piano { position: relative; height: 140px; width: 1050px; margin: 0 auto; }
        .white-key { position: absolute; width: 35px; height: 140px; background: linear-gradient(to bottom, #ffffff 0%, #f0f0f0 100%); border: 2px solid #222; border-radius: 0 0 4px 4px; cursor: pointer; user-select: none; touch-action: manipulation; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 4px; font-size: 8px; color: #666; font-weight: bold; transition: all 0.05s; }
        .white-key.active { background: linear-gradient(145deg, #b3e5fc 0%, #4fc3f7 100%); color: #0277bd; }
        .white-key.chord-active {
            background: linear-gradient(to bottom, #FFE680 0%, #FFD966 100%);
            box-shadow: inset 0 1px 3px rgba(255, 200, 0, 0.4);
        }
        .white-key:active { background: linear-gradient(145deg, #b3e5fc 0%, #4fc3f7 100%); color: #0277bd; }
        .black-key { position: absolute; width: 24px; height: 85px; background: linear-gradient(to bottom, #444 0%, #000 100%); border: 1px solid #000; border-radius: 0 0 3px 3px; cursor: pointer; user-select: none; touch-action: manipulation; z-index: 10; color: white; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 3px; font-size: 7px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.5); transition: all 0.05s; }
        .black-key.active { background: linear-gradient(145deg, #b3e5fc 0%, #4fc3f7 100%); color: #0277bd; }
        .black-key.chord-active {
            background: linear-gradient(to bottom, #FFE680 0%, #FFD966 100%);
            box-shadow: inset 0 1px 3px rgba(255, 200, 0, 0.4);
            color: #444;
        }
        .black-key:active { background: linear-gradient(145deg, #b3e5fc 0%, #4fc3f7 100%); color: #0277bd; }
        .info { text-align: center; color: white; margin-top: 8px; font-size: 11px; line-height: 1.4; }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 8px; position: relative;">
            <h1 class="title" style="margin: 0;">üéπ ƒê√†n Piano</h1>
            <div style="position: absolute; right: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px;">
                <button class="sound-toggle muted" id="soundToggle">
                    <span id="soundIcon">üîá</span>
                </button>
                <span style="color: white; font-size: 10px; font-weight: bold;" id="soundStatus">T·∫Øt √¢m</span>
            </div>
        </div>
        <div class="created-by">Created by Minh Nh·ª±t</div>
        <div class="chords-section">
            <div class="chords-title">üé∏ Nh·∫°c C·ª•</div>
            <div class="instrument-selector">
                <button class="instrument-current" id="instrumentCurrent">
                    <span id="instrumentName">üé∏ Guitar</span>
                    <span id="dropdownArrow">‚ñº</span>
                </button>
                <div class="instrument-dropdown" id="instrumentDropdown">
                    <button class="instrument-option" data-instrument="piano">üéπ Piano</button>
                    <button class="instrument-option" data-instrument="guitar">üé∏ Guitar</button>
                    <button class="instrument-option" data-instrument="violin">üéª Violin</button>
                    <button class="instrument-option" data-instrument="flute">üé∫ Flute</button>
                    <button class="instrument-option" data-instrument="organ">üéõÔ∏è Organ</button>
                    <button class="instrument-option" data-instrument="synth">üéπ Synth</button>
                    <button class="instrument-option" data-instrument="bass">üé∏ Bass</button>
                    <button class="instrument-option" data-instrument="trumpet">üé∫ Trumpet</button>
                    <button class="instrument-option" data-instrument="saxophone">üé∑ Saxophone</button>
                    <button class="instrument-option" data-instrument="harp">üéµ Harp</button>
                    <button class="instrument-option" data-instrument="xylophone">üéº Xylophone</button>
                    <button class="instrument-option" data-instrument="marimba">ü•Å Marimba</button>
                    <button class="instrument-option" data-instrument="bells">üîî Bells</button>
                    <button class="instrument-option" data-instrument="mandolin">üé∏ Mandolin</button>
                    <button class="instrument-option" data-instrument="ukulele">üé∏ Ukulele</button>
                    <button class="instrument-option" data-instrument="harmonica">üéôÔ∏è Harmonica</button>
                    <button class="instrument-option" data-instrument="oboe">üé∫ Oboe</button>
                    <button class="instrument-option" data-instrument="clarinet">üé∫ Clarinet</button>
                    <button class="instrument-option" data-instrument="french-horn">üé∫ French Horn</button>
                    <button class="instrument-option" data-instrument="trombone">üé∫ Trombone</button>
                    <button class="instrument-option" data-instrument="cello">üéª Cello</button>
                    <button class="instrument-option" data-instrument="drum">ü•Å Drum Kit</button>
                </div>
            </div>
            
            <div class="tone-selector" id="toneSelector"></div>
            
            <div class="chords-title" id="currentTone">H·ª£p √Çm - Tone Dm</div>
            <div class="chords-grid" id="chordsGrid"></div>
        </div>
        
        <div class="piano-container">
            <div class="piano" id="piano"></div>
        </div>
        
        <div class="info">
            B·∫•m h·ª£p √¢m ph√≠a tr√™n ‚Ä¢ B·∫•m ph√≠m ƒë√†n ƒë·ªÉ ch∆°i giai ƒëi·ªáu
        </div>
    </div>

    <script>
        let audioContext = null;
        let isMuted = true;
        let currentTone = 'Dm';
        let currentInstrument = 'guitar'; // <--- ƒê·∫∑t m·∫∑c ƒë·ªãnh l√† guitar
        
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }
        
        window.addEventListener('load', () => {
            initAudioContext();
            // C·∫≠p nh·∫≠t t√™n nh·∫°c c·ª• hi·ªÉn th·ªã m·∫∑c ƒë·ªãnh l√† guitar
            document.getElementById('instrumentName').textContent = instrumentSettings[currentInstrument].name;
        });
        
        const soundToggle = document.getElementById('soundToggle');
        const soundIcon = document.getElementById('soundIcon');
        const soundStatus = document.getElementById('soundStatus');
        
        soundToggle.addEventListener('click', () => {
            initAudioContext();
            isMuted = !isMuted;
            soundToggle.classList.toggle('muted', isMuted);
            soundIcon.textContent = isMuted ? 'üîá' : 'üîä';
            soundStatus.textContent = isMuted ? 'T·∫Øt √¢m' : 'B·∫≠t √¢m';
        });

        // NOTE MAP
        const notes = {
            'C3': 130.81, 'C#3': 138.59, 'D3': 146.83, 'D#3': 155.56,
            'E3': 164.81, 'F3': 174.61, 'F#3': 185.00, 'G3': 196.00,
            'G#3': 207.65, 'A3': 220.00, 'A#3': 233.08, 'B3': 246.94,
            'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
            'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
            'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
            'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 
            'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99,
            'G#5': 830.61, 'A5': 880.00, 'A#5': 932.33, 'B5': 987.77,
            'C6': 1046.50
        };

        // INSTRUMENTS
        const instrumentSettings = {
            piano: { type: 'sine', attack: 0.005, decay: 2.0, sustain: 0.4, release: 0.2, name: 'üéπ Piano' },
            guitar: { type: 'triangle', attack: 0.01, decay: 1.2, sustain: 0.3, release: 0.1, name: 'üé∏ Guitar' },
            violin: { type: 'sawtooth', attack: 0.1, decay: 2.0, sustain: 0.35, release: 0.001, name: 'üéª Violin' },
            flute: { type: 'sine', attack: 0.1, decay: 1.5, sustain: 0.25, release: 0.05, name: 'üé∫ Flute' },
            organ: { type: 'square', attack: 0.001, decay: 2.5, sustain: 0.4, release: 0.001, name: 'üéõÔ∏è Organ' },
            synth: { type: 'sawtooth', attack: 0.02, decay: 1.0, sustain: 0.3, release: 0.001, name: 'üéπ Synth' },
            bass: { type: 'sine', attack: 0.02, decay: 0.8, sustain: 0.25, release: 0.05, name: 'üé∏ Bass' },
            trumpet: { type: 'square', attack: 0.08, decay: 1.5, sustain: 0.3, release: 0.001, name: 'üé∫ Trumpet' },
            saxophone: { type: 'sawtooth', attack: 0.06, decay: 1.8, sustain: 0.35, release: 0.001, name: 'üé∑ Saxophone' },
            harp: { type: 'sine', attack: 0.001, decay: 1.2, sustain: 0.15, release: 0.001, name: 'üéµ Harp' },
            xylophone: { type: 'sine', attack: 0.001, decay: 0.5, sustain: 0.1, release: 0.001, name: 'üéº Xylophone' },
            marimba: { type: 'sine', attack: 0.002, decay: 0.7, sustain: 0.15, release: 0.001, name: 'ü•Å Marimba' },
            bells: { type: 'sine', attack: 0.001, decay: 2.0, sustain: 0.2, release: 0.001, name: 'üîî Bells' },
            mandolin: { type: 'triangle', attack: 0.003, decay: 0.6, sustain: 0.2, release: 0.001, name: 'üé∏ Mandolin' },
            ukulele: { type: 'triangle', attack: 0.004, decay: 0.5, sustain: 0.15, release: 0.001, name: 'üé∏ Ukulele' },
            harmonica: { type: 'triangle', attack: 0.03, decay: 0.9, sustain: 0.3, release: 0.08, name: 'üéôÔ∏è Harmonica' },
            oboe: { type: 'sawtooth', attack: 0.08, decay: 1.3, sustain: 0.3, release: 0.001, name: 'üé∫ Oboe' },
            clarinet: { type: 'triangle', attack: 0.08, decay: 1.0, sustain: 0.35, release: 0.06, name: 'üé∫ Clarinet' },
            'french-horn': { type: 'square', attack: 0.1, decay: 1.6, sustain: 0.32, release: 0.001, name: 'üé∫ French Horn' },
            trombone: { type: 'sawtooth', attack: 0.09, decay: 1.4, sustain: 0.3, release: 0.001, name: 'üé∫ Trombone' },
            cello: { type: 'sawtooth', attack: 0.12, decay: 1.9, sustain: 0.33, release: 0.001, name: 'üéª Cello' },
            drum: { type: 'sine', attack: 0.001, decay: 0.3, sustain: 0, release: 0.001, name: 'ü•Å Drum Kit', isDrum: true }
        };

        // H·ª¢P √ÇM (ƒë√£ ch·ªânh th·∫•p h∆°n 1 octave so v·ªõi m·∫∑c ƒë·ªãnh)
        const chords = {
            'C': ['C3', 'E3', 'G3'],
            'C#': ['C#3', 'F3', 'G#3'],
            'Cm': ['C3', 'D#3', 'G3'],
            'C#m': ['C#3', 'E3', 'G#3'],
            'C7': ['C3', 'E3', 'G3', 'A#3'],
            'C#7': ['C#3', 'F3', 'G#3', 'B3'],
            'D': ['D3', 'F#3', 'A3'],
            'D#': ['D#3', 'G3', 'A#3'],
            'Dm': ['D3', 'F3', 'A3'],
            'D#m': ['D#3', 'F#3', 'A#3'],
            'D7': ['D3', 'F#3', 'A3', 'C4'],
            'E': ['E3', 'G#3', 'B3'],
            'Eb': ['D#3', 'G3', 'A#3'],
            'Em': ['E3', 'G3', 'B3'],
            'Em7': ['E3', 'G3', 'B3', 'D4'],
            'E7': ['E3', 'G#3', 'B3', 'D4'],
            'F': ['F3', 'A3', 'C4'],
            'F#': ['F#3', 'A#3', 'C#4'],
            'Fm': ['F3', 'G#3', 'C4'],
            'F#m': ['F#3', 'A3', 'C#4'],
            'F#7': ['F#3', 'A#3', 'C#4', 'E4'],
            'G': ['G3', 'B3', 'D4'],
            'G#': ['G#3', 'C4', 'D#4'],
            'Gm': ['G3', 'A#3', 'D4'],
            'G#m': ['G#3', 'B3', 'D#4'],
            'G7': ['G3', 'B3', 'D4', 'F4'],
            'A': ['A3', 'C#4', 'E4'],
            'A#': ['A#3', 'D4', 'F4'],
            'Am': ['A3', 'C4', 'E4'],
            'A7': ['A3', 'C#4', 'E4', 'G3'],
            'Am7': ['A3', 'C4', 'E4', 'G4'],
            'B': ['B3', 'D#4', 'F#4'],
            'Bm': ['B3', 'D4', 'F#4'],
            'Bb': ['A#3', 'D4', 'F3'],
            'D#m7': ['D#3', 'F#3', 'A#3', 'C#4'],
            'Dm7': ['D3', 'F3', 'A3', 'C4'],
            'F#m7': ['F#3', 'A3', 'C#4', 'E4'],
            'G#m': ['G#3', 'B3', 'D#4'],
            'Db': ['C#3', 'F3', 'G#3'],
        };

        // Tone v√† c√°c h·ª£p √¢m cho m·ªói tone
        const toneChords = {
            'Dm': ['Dm', 'Gm', 'Bb', 'C', 'F', 'G', 'A7', 'Am', 'E'],
            'Bm': ['Bm', 'Em', 'D#', 'F#', 'B', 'C#', 'F#7', 'F#m', 'G#'],
            'Am': ['Am', 'Dm', 'G', 'Bb', 'Eb', 'A', 'D7', 'Em', 'B'],
            'D#m': ['D#m', 'G#m', 'B', 'C#', 'F#', 'G#', 'C#7', 'C#m', 'F#7'],
            'Gm': ['Gm', 'Cm', 'Bb', 'Db', 'F', 'G', 'D7', 'D', 'A'],
            'Em': ['Em', 'Am', 'G', 'Bb', 'D', 'E', 'A7', 'Bm', 'F#']
        };

        // Piano key data
        const piano = document.getElementById('piano');
        const whiteKeysData = [
            {note: 'C3', left: 0}, {note: 'D3', left: 35}, {note: 'E3', left: 70},
            {note: 'F3', left: 105}, {note: 'G3', left: 140}, {note: 'A3', left: 175},
            {note: 'B3', left: 210}, {note: 'C4', left: 245}, {note: 'D4', left: 280},
            {note: 'E4', left: 315}, {note: 'F4', left: 350}, {note: 'G4', left: 385},
            {note: 'A4', left: 420}, {note: 'B4', left: 455}, {note: 'C5', left: 490},
            {note: 'D5', left: 525}, {note: 'E5', left: 560}, {note: 'F5', left: 595},
            {note: 'G5', left: 630}, {note: 'A5', left: 665}, {note: 'B5', left: 700},
            {note: 'C6', left: 735}
        ];
        const blackKeysData = [
            {note: 'C#3', left: 24}, {note: 'D#3', left: 59},
            {note: 'F#3', left: 129}, {note: 'G#3', left: 164}, {note: 'A#3', left: 199},
            {note: 'C#4', left: 269}, {note: 'D#4', left: 304},
            {note: 'F#4', left: 374}, {note: 'G#4', left: 409}, {note: 'A#4', left: 444},
            {note: 'C#5', left: 514}, {note: 'D#5', left: 549},
            {note: 'F#5', left: 619}, {note: 'G#5', left: 654}, {note: 'A#5', left: 689}
        ];
        function createKey(isBlack, data) {
            const key = document.createElement('div');
            key.className = isBlack ? 'black-key' : 'white-key';
            key.dataset.note = data.note;
            key.textContent = data.note;
            key.style.left = data.left + 'px';

            // S·ª≠ d·ª•ng mouseup/mousedown/touchstart/touchend ƒë·ªÉ hi·ªÉn th·ªã tr·∫°ng th√°i nh·∫•n ph√≠m m√†u xanh nh·∫°t
            const playKeyNote = () => playNote(data.note, key);

            // B·∫Øt ƒë·∫ßu nh·∫•n
            key.addEventListener('mousedown', () => {
                key.classList.add('active');
                playKeyNote();
            });
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                key.classList.add('active');
                playKeyNote();
            });
            // K·∫øt th√∫c nh·∫•n
            key.addEventListener('mouseup', () => {
                key.classList.remove('active');
            });
            key.addEventListener('mouseleave', () => {
                key.classList.remove('active');
            });
            key.addEventListener('touchend', () => {
                key.classList.remove('active');
            });

            return key;
        }
        whiteKeysData.forEach(data => {
            piano.appendChild(createKey(false, data));
        });
        blackKeysData.forEach(data => {
            piano.appendChild(createKey(true, data));
        });

        // PLAY NOTE
        function playNote(note, keyElement, isChord = false) {
            if (!audioContext || !notes[note] || isMuted) return;
            initAudioContext();
            if (keyElement) {
                const activeClass = isChord ? 'chord-active' : 'active';
                keyElement.classList.add(activeClass);
                const settings = instrumentSettings[currentInstrument];
                const duration = settings.isDrum ? 150 : (settings.decay * 1000);
                setTimeout(() => {
                    keyElement.classList.remove(activeClass);
                }, duration);
            }
            const settings = instrumentSettings[currentInstrument];
            if (settings.isDrum) {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.frequency.setValueAtTime(notes[note] * 1.5, audioContext.currentTime);
                osc.frequency.exponentialRampToValueAtTime(30, audioContext.currentTime + 0.15);
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.8, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + 0.15);
                return;
            }
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.value = notes[note];
            osc.type = settings.type;
            const now = audioContext.currentTime;
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(settings.sustain, now + settings.attack);
            gain.gain.exponentialRampToValueAtTime(settings.release, now + settings.decay);
            osc.start(now);
            osc.stop(now + settings.decay);
        }

        // PLAY CHORD: Hi·ªÉn th·ªã n·ªët v√† ph√°t √¢m
        function playChord(chordName) {
            const chordNotes = chords[chordName];
            if (!chordNotes) {
                alert(`H·ª£p √¢m ${chordName} ch∆∞a ƒë∆∞·ª£c h·ªó tr·ª£!`);
                return;
            }
            chordNotes.forEach(note => {
                const keyElement = document.querySelector(`[data-note="${note}"]`);
                playNote(note, keyElement, true);
            });
        }

        // Hi·ªÉn th·ªã c√°c h·ª£p √¢m cho t·ª´ng tone, t√¥ m√†u n·ªët
        function showChordOnKeys(chordName) {
            // X√≥a tr·∫°ng th√°i chord-active tr√™n t·∫•t c·∫£ ph√≠m
            document.querySelectorAll('.white-key,.black-key').forEach(key => {
                key.classList.remove('chord-active');
            });
            const chordNotes = chords[chordName];
            if (!chordNotes) return;
            chordNotes.forEach(note => {
                const keyElement = document.querySelector(`[data-note="${note}"]`);
                if (keyElement) keyElement.classList.add('chord-active');
            });
        }

        // TONE SELECTOR
        function renderToneSelector() {
            const selector = document.getElementById('toneSelector');
            selector.innerHTML = '';
            Object.keys(toneChords).forEach(tone => {
                const btn = document.createElement('button');
                btn.className = 'tone-btn';
                btn.dataset.tone = tone;
                btn.textContent = tone;
                if (tone === currentTone) btn.classList.add('active');
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tone-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTone = tone;
                    renderChords(tone);
                });
                selector.appendChild(btn);
            });
        }

        // CHORD GRID
        function renderChords(tone) {
            const grid = document.getElementById('chordsGrid');
            const title = document.getElementById('currentTone');
            grid.innerHTML = '';
            title.textContent = `H·ª£p √Çm - Tone ${tone}`;
            if (toneChords[tone]) {
                toneChords[tone].forEach(chordName => {
                    const btn = document.createElement('button');
                    btn.className = 'chord-btn';
                    btn.dataset.chord = chordName;
                    btn.textContent = chordName;
                    btn.addEventListener('touchstart', (e) => { e.preventDefault(); playChord(chordName); showChordOnKeys(chordName); });
                    btn.addEventListener('click', () => { playChord(chordName); showChordOnKeys(chordName); });
                    grid.appendChild(btn);
                });
            }
        }

        // INSTRUMENT SELECTOR
        const instrumentCurrent = document.getElementById('instrumentCurrent');
        const instrumentDropdown = document.getElementById('instrumentDropdown');
        const instrumentName = document.getElementById('instrumentName');
        const dropdownArrow = document.getElementById('dropdownArrow');
        
        instrumentCurrent.addEventListener('click', () => {
            instrumentDropdown.classList.toggle('open');
            dropdownArrow.textContent = instrumentDropdown.classList.contains('open') ? '‚ñ≤' : '‚ñº';
        });
        document.querySelectorAll('.instrument-option').forEach(btn => {
            btn.addEventListener('click', () => {
                currentInstrument = btn.dataset.instrument;
                instrumentName.textContent = instrumentSettings[currentInstrument].name;
                instrumentDropdown.classList.remove('open');
                dropdownArrow.textContent = '‚ñº';
            });
        });
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.instrument-selector')) {
                instrumentDropdown.classList.remove('open');
                dropdownArrow.textContent = '‚ñº';
            }
        });

        renderToneSelector();
        renderChords(currentTone);
        // Hi·ªÉn th·ªã n·ªët h·ª£p √¢m m·∫∑c ƒë·ªãnh
        showChordOnKeys(toneChords[currentTone][0]);
    </script>
</body>
</html>